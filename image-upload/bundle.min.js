!function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,n=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),a=n&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),i=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,o=(n||i)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,o,r,l,u,s;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),o=new ArrayBuffer(e.length),r=new Uint8Array(o),l=0;l<e.length;l+=1)r[l]=e.charCodeAt(l);return u=t.split(",")[0].split(":")[1].split(";")[0],n?new Blob([a?r:o],{type:u}):(s=new i,s.append(o),s.getBlob(u))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,n,a){t(a&&e.toDataURL&&o?o(this.toDataURL(n,a)):this.mozGetAsFile("blob",n))}:e.toDataURL&&o&&(e.toBlob=function(t,e,n){t(o(this.toDataURL(e,n)))})),"function"==typeof define&&define.amd?define(function(){return o}):t.dataURLtoBlob=o}(window),window.resize=function(){"use strict";function t(){}return t.prototype={init:function(t){this.outputQuality="undefined"===t?.8:t},photo:function(t,e,n,a){var i=this,o=new FileReader;o.onload=function(t){i.resize(t.target.result,e,n,a)},o.readAsDataURL(t)},resize:function(t,e,n,a){var i=this,o=new Image;o.onload=function(t){var r=document.createElement("canvas"),l=o.width,u=o.height;l>u?l>e&&(u*=e/l,l=e):u>e&&(l*=e/u,u=e),r.width=l,r.height=u,r.getContext("2d").drawImage(o,0,0,l,u),i.output(r,n,a)},o.src=t},output:function(t,e,n){switch(e){case"file":t.toBlob(function(t){n(t)},"image/jpeg",.8);break;case"dataURL":n(t.toDataURL("image/jpeg",.8))}}},t}(),window.resize=function(){"use strict";function t(){}return t.prototype={init:function(t){this.outputQuality="undefined"===t?.8:t},photo:function(t,e,n,a){var i=this,o=new FileReader;o.onload=function(t){i.resize(t.target.result,e,n,a)},o.readAsDataURL(t)},resize:function(t,e,n,a){var i=this,o=new Image;o.onload=function(t){var r=document.createElement("canvas"),l=o.width,u=o.height;l>u?l>e&&(u*=e/l,l=e):u>e&&(l*=e/u,u=e),r.width=l,r.height=u,r.getContext("2d").drawImage(o,0,0,l,u),i.output(r,n,a)},o.src=t},output:function(t,e,n){switch(e){case"file":t.toBlob(function(t){n(t)},"image/jpeg",.8);break;case"dataURL":n(t.toDataURL("image/jpeg",.8))}}},t}(),function($){$.fn.imageUpload=function(t){var e={},n=$.extend(e,t),a=new window.resize;a.init();var i={upload:function(t,e,n){var a=new FormData;a.append("photo",e);var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&n(i.response)},i.open("POST",t),i.responseType="json",i.send(a)},dataURLtoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(e.length),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);return new Blob([a],{type:n})},fileSize:function(t){var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["B","kB","MB","GB","TB"][e]},setThumbnail:function(t,e,n){var a=$('<div class="form-image-upload-thumbnail"><div class="close-overlay"><a href="#"><i class="remove huge icon"></i>'+n+'</a></div><img src=""></div></div>');a.find("img").attr("src",e),t.empty().append(a)},setButtonLabel:function(t,e){t.find("span").text(e)}};return this.each(function(){var t=$(this).parent(),e=t.find(".button"),n=t.find("input[type=file]"),o=t.find("input[type=hidden]"),r=t.data("upload-url"),l=t.data("image-width"),u=t.data("thumb-width"),s=$(t.data("thumb-container")),c=t.data("attach-label"),d=t.data("replace-label"),f=t.data("remove-label");""!==o.val()&&i.setThumbnail(s,o.val(),f),s.on("click",function(t){t.preventDefault(),s.empty(),i.setButtonLabel(e,c),o.val("")}),e.on("click",function(t){t.preventDefault(),n.click()}),n.on("change",function(t){t.preventDefault();var n=t.target.files;n.length>0&&e.toggleClass("loading");for(var c in n){if("object"!=typeof n[c])return!1;!function(){var t=n[c].size;a.photo(n[c],l,"file",function(t){var n=t.size;i.upload(r,t,function(t){o.val(t.url),i.setButtonLabel(e,d),e.hasClass("red")&&e.removeClass("red").addClass("basic")}),a.photo(t,u,"dataURL",function(t){i.setThumbnail(s,t,f),e.toggleClass("loading")})})}()}})})}}(jQuery);