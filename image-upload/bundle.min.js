!function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,a=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),n=a&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),i=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,o=(a||i)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,o,r,l,s,u;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),o=new ArrayBuffer(e.length),r=new Uint8Array(o),l=0;l<e.length;l+=1)r[l]=e.charCodeAt(l);return s=t.split(",")[0].split(":")[1].split(";")[0],a?new Blob([n?r:o],{type:s}):(u=new i,u.append(o),u.getBlob(s))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,a,n){t(n&&e.toDataURL&&o?o(this.toDataURL(a,n)):this.mozGetAsFile("blob",a))}:e.toDataURL&&o&&(e.toBlob=function(t,e,a){t(o(this.toDataURL(e,a)))})),"function"==typeof define&&define.amd?define(function(){return o}):t.dataURLtoBlob=o}(window),window.resize=function(){"use strict";function t(){}return t.prototype={init:function(t){this.outputQuality="undefined"===t?.8:t},photo:function(t,e,a,n,i,o){var r=this,l=new FileReader;l.onload=function(l){var s=new FileReader;s.onload=function(s){for(var u,c="",d=new Uint8Array(s.target.result).subarray(0,4),f=0;f<d.length;f++)c+=d[f].toString(16);switch(c){case"89504e47":u="image/png";break;case"47494638":u="image/gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":u="image/jpeg";break;default:u=t.type;break}o&&(u=o),r.resize(l.target.result,u,e,a,n,i)},s.readAsArrayBuffer(t)},l.readAsDataURL(t)},resize:function(t,e,a,n,i,o){var r=this,l=new Image;l.onload=function(t){var s=document.createElement("canvas"),u=l.width,c=l.height;u>c?u>a&&(c*=a/u,u=a):c>a&&(u*=a/c,c=a),s.width=u,s.height=c,s.getContext("2d").drawImage(l,0,0,u,c),r.output(s,e,n,i,o)},l.src=t},output:function(t,e,a,n,i){switch(a){case"file":t.toBlob(function(t){i(t)},e,n);break;case"dataURL":i(t.toDataURL(e,n),e);break}}},t}(),function($){$.fn.imageUpload=function(){var t=new window.resize;t.init();var e={dataURLtoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return new Blob([n],{type:a})},fileSize:function(t){var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["B","kB","MB","GB","TB"][e]},setThumbnail:function(t,e,a){var n=$('<div class="form-image-upload-thumbnail"><div class="menu-overlay"><a href="#" class="remove-anchor"><i class="remove large icon"></i></a><a href="'+e+'" class="download-anchor" target="_blank"><i class="download large icon"></i></a></div><img src=""></div></div>');a||(a=e),n.find("img").attr("src",a),n.find(".download-anchor").click(function(t){t.preventDefault();var e=$(this),a=null;"data:"===e.attr("href").substr(0,5)&&(a=(new Date).getTime()),download($(this).attr("href"),a)}),t.empty().append(n)},setButtonLabel:function(t,e){t.find("span").text(e)}};return this.each(function(){var a=$(this).parent(),n=a.find(".button"),i=a.find("input[type=file]"),o=a.find("textarea"),r=parseFloat(a.data("image-quality")),l=a.data("image-width"),s=a.data("thumb-width"),u=$("#"+a.data("thumb-container")),c=a.data("attach-label"),d=a.data("replace-label"),f=a.data("no-thumb-container"),h=null;1===f&&(u.before($('<div id="'+a.data("thumb-container").replace("#","").replace(".","")+'-no-thumb" class="form-image-upload-no-thumbnail"></div>')),h=$(a.data("thumb-container")+"-no-thumb")),""!==o.val()?e.setThumbnail(u,o.val()):h&&h.css("display","block"),u.on("click","a.remove-anchor",function(t){t.preventDefault(),u.empty(),e.setButtonLabel(n,c),o.val(""),h&&h.css("display","block")}),n.on("click",function(t){t.preventDefault(),i.click()}),a.on("change","input[type=file]",function(a){a.preventDefault();var i=a.target.files;i.length>0&&n.toggleClass("loading");for(var c in i){if("object"!=typeof i[c])return!1;!function(){t.photo(i[c],l,"dataURL",r,function(a,i){o.val(a),e.setButtonLabel(n,d),n.hasClass("red")&&n.removeClass("red").addClass("basic"),t.photo(e.dataURLtoBlob(a),s,"dataURL",1,function(t,i){h&&h.css("display","none"),e.setThumbnail(u,a,t),n.toggleClass("loading")})})}()}})})}}(jQuery);